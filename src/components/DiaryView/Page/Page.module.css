.page {
  background-color: #fffcf0; /* A slightly yellowish, paper-like color */
  width: 100%;
  aspect-ratio: 210 / 297; /* A4-like proportion */
  max-width: 700px;
  min-height: 70vh; 
  max-height: 80vh;
  margin: 0 auto;
  /* Page padding defines the "unwritable" margins of the paper */
  padding: 25px 25px 25px 45px; /* top, right, bottom, left (left accommodates red margin line) */
  box-shadow: 0 0 15px rgba(0,0,0,0.1);
  position: relative; /* Crucial for absolute positioning of children */
  overflow: hidden; /* Clip content, but might clip curl if not handled by pageContainer */
  font-family: 'Courier New', Courier, monospace;
  line-height: 1.8; /* This will be inherited by editorArea */
  font-size: 16px;  /* This will be inherited by editorArea */
  color: #333;      /* This will be inherited by editorArea */
  border-radius: 3px;
  transform-style: preserve-3d; /* For 3D animations */
  backface-visibility: hidden; /* Hide back of page during flip */
}

body.dark-theme .page {
  background-color: #2c2c3e; /* Darker paper for dark theme */
  color: #c0c0d0;
  box-shadow: 0 0 15px rgba(0,0,0,0.4);
}

.pageDate {
  position: absolute;
  top: 10px;    /* Position from top edge of .page div */
  right: 25px;  /* Position from right edge of .page div */
  font-size: 0.85em;
  color: #555;
  font-style: italic;
  z-index: 2; /* Above ruled lines */
}

body.dark-theme .pageDate {
  color: #aaa;
}

.leftMarginLine {
  position: absolute;
  top: 0;    /* Stretch full height of .page */
  bottom: 0;
  left: 40px; /* 40px from the very left edge of the .page div */
  width: 1px;
  background-color: #ffaaaa; /* Faint red line */
  z-index: 0; /* Behind text and ruled lines */
}

body.dark-theme .leftMarginLine {
  background-color: #885555;
}

.ruledLinesContainer {
  position: absolute;
  top: 40px;    /* Start of ruled area, below date */
  left: 45px;   /* Start right of the red margin line */
  right: 25px;  /* Right margin for ruled area */
  bottom: 25px; /* Bottom margin for ruled area */
  z-index: 0; /* Behind editor text */
  pointer-events: none; /* So it doesn't interfere with text selection */
  display: flex;
  flex-direction: column;
}

.ruleLine {
  height: 1.8em; /* Match editor line-height for alignment */
  border-bottom: 1px solid #d0e0ff; /* Light blue lines */
  box-sizing: border-box;
  flex-shrink: 0; /* Prevent lines from shrinking if container is too small */
}

body.dark-theme .ruleLine {
  border-bottom: 1px solid #405077; /* Darker lines for dark theme */
}

.editorArea {
  position: absolute;
  top: 40px;    /* Align with .ruledLinesContainer.top */
  left: 45px;   /* Align with .ruledLinesContainer.left */
  right: 25px;  /* Align with .ruledLinesContainer.right */
  height: calc(1.8em * 18); /* MAX_LINES = 18. This is critical for overflow. */
  z-index: 1;   /* Text on top of ruled lines */
  
  outline: none;
  white-space: pre-wrap; 
  word-wrap: break-word; 
  
  margin: 0;
  padding: 0; /* NO PADDING inside editor area itself */
  
  overflow-y: hidden !important; /* CRUCIAL: Hide vertical overflow. Text beyond 18 lines is not visible. */
  overflow-x: hidden; /* Typically no horizontal scroll on a notebook page */
  
  box-sizing: border-box; /* padding/border do not add to width/height */

  /* Inherit from .page by default, but can be explicit for clarity */
  font-family: inherit; 
  font-size: inherit;   
  line-height: inherit; 
  color: inherit;       
  caret-color: #5a3e8d; 
}

body.dark-theme .editorArea {
  caret-color: #a991d4;
  color: #c0c0d0; /* Ensure dark theme text color is applied if not inherited properly */
}

.editorArea:focus {
  outline: none; 
}

/* Page Curl Animations - More Realistic */
.pageAnimating {
  transition: none !important;
}

@keyframes curlNextRealistic {
  0% {
    transform-origin: 100% 0%; /* Top-right corner */
    transform: perspective(2000px) rotateY(0deg) rotateX(0deg) translateZ(0px) scale(1);
    opacity: 1;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  30% {
    transform: perspective(2000px) rotateY(-25deg) rotateX(5deg) translateZ(30px) scale(0.95) translateX(-10%);
    opacity: 0.95;
    box-shadow: -8px 5px 25px rgba(0,0,0,0.15);
  }
  100% {
    transform-origin: 100% 0%;
    transform: perspective(2000px) rotateY(-150deg) rotateX(15deg) translateZ(-150px) scale(0.5) translateX(-110%);
    opacity: 0;
    box-shadow: -30px 15px 50px rgba(0,0,0,0.3);
  }
}

.pageCurlNext {
  animation: curlNextRealistic 0.6s ease-in-out forwards;
  z-index: 20; /* Ensure turning page is on top during animation */
}


@keyframes curlPrevRealistic {
  0% {
    transform-origin: 0% 0%; /* Top-left corner */
    transform: perspective(2000px) rotateY(0deg) rotateX(0deg) translateZ(0px) scale(1);
    opacity: 1;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  30% {
    transform: perspective(2000px) rotateY(25deg) rotateX(5deg) translateZ(30px) scale(0.95) translateX(10%);
    opacity: 0.95;
    box-shadow: 8px 5px 25px rgba(0,0,0,0.15);
  }
  100% {
    transform-origin: 0% 0%;
    transform: perspective(2000px) rotateY(150deg) rotateX(15deg) translateZ(-150px) scale(0.5) translateX(110%);
    opacity: 0;
    box-shadow: 30px 15px 50px rgba(0,0,0,0.3);
  }
}

.pageCurlPrev {
  animation: curlPrevRealistic 0.6s ease-in-out forwards;
  z-index: 20; /* Ensure turning page is on top */
}

/* Dark theme adjustments for shadows for the curl effect */
body.dark-theme .pageCurlNext {
  box-shadow: -30px 15px 50px rgba(0,0,0,0.7) !important;
}
body.dark-theme .pageCurlPrev {
  box-shadow: 30px 15px 50px rgba(0,0,0,0.7) !important;
}